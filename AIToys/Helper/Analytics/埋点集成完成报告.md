# åŸ‹ç‚¹é›†æˆå®ŒæˆæŠ¥å‘Š

## ğŸ“Š æ¦‚è¿°

æ ¹æ®æä¾›çš„CSVæ–‡ä»¶å’Œæ¥å£æ–‡æ¡£ï¼Œå·²æˆåŠŸä¸ºAIToysé¡¹ç›®é›†æˆäº†å®Œæ•´çš„åŸ‹ç‚¹ç³»ç»Ÿã€‚æ‰€æœ‰åŸ‹ç‚¹äº‹ä»¶å·²æŒ‰ç…§éœ€æ±‚æ–‡æ¡£è¿›è¡Œå®ç°å’Œéƒ¨ç½²ã€‚

## âœ… å·²å®Œæˆçš„åŸ‹ç‚¹é›†æˆ

### 1. é¦–é¡µç›¸å…³åŸ‹ç‚¹

#### 1.1 Bannerç‚¹å‡»åŸ‹ç‚¹
- **æ–‡ä»¶ä½ç½®**: `AIToys/Home/HomeViewController.m`
- **è§¦å‘æ—¶æœº**: ç”¨æˆ·ç‚¹å‡»é¦–é¡µè½®æ’­å›¾Banneræ—¶
- **å®ç°ä»£ç **:
```objc
// åŸ‹ç‚¹ä¸ŠæŠ¥ï¼šç‚¹å‡»è¿è¥banner
[[AnalyticsManager sharedManager] reportClickBannerWithId:model.Id ?: @"" 
                                                      name:model.title ?: @""];
```

#### 1.2 æˆ‘çš„è®¾å¤‡ç‚¹å‡»åŸ‹ç‚¹
- **æ–‡ä»¶ä½ç½®**: `AIToys/Home/HomeViewController.m`
- **è§¦å‘æ—¶æœº**: ç”¨æˆ·ç‚¹å‡»æˆ‘çš„è®¾å¤‡åˆ—è¡¨ä¸­çš„è®¾å¤‡æ—¶
- **å®ç°ä»£ç **:
```objc
// åŸ‹ç‚¹ä¸ŠæŠ¥ï¼šæˆ‘çš„è®¾å¤‡ç‚¹å‡»
[[AnalyticsManager sharedManager] reportMyDeviceClickWithDeviceId:weakSelf.deviceArr[index].devId ?: @""];
```

#### 1.3 æˆ‘çš„å…¬ä»”ç‚¹å‡»åŸ‹ç‚¹
- **æ–‡ä»¶ä½ç½®**:
  - `AIToys/Home/HomeViewController.m`
  - `AIToys/Home/HomeToysListVC.m`
- **è§¦å‘æ—¶æœº**: ç”¨æˆ·ç‚¹å‡»æˆ‘çš„å…¬ä»”æ—¶
- **å®ç°ä»£ç **:
```objc
// åŸ‹ç‚¹ä¸ŠæŠ¥ï¼šæˆ‘çš„å…¬ä»”ç‚¹å‡»
HomeDollModel *dollModel = weakSelf.diyDollList[index];
[[AnalyticsManager sharedManager] reportMyDollClickWithId:dollModel.Id ?: @""
                                                     name:dollModel.dollModel.name ?: @""];
```

#### 1.4 å‘ç°åˆ›æ„å…¬ä»”åŸ‹ç‚¹
- **æ–‡ä»¶ä½ç½®**: `AIToys/Home/HomeViewController.m`
- **è§¦å‘æ—¶æœº**: è®¾å¤‡DPæ›´æ–°æ£€æµ‹åˆ°åˆ›æ„å…¬ä»”ç¡¬ä»¶ç æ—¶
- **å®ç°ä»£ç **:
```objc
// è®¾å¤‡DPæ›´æ–° â†’ æ£€æµ‹åˆ°å…¬ä»”ç¡¬ä»¶ç (DPç‚¹"103") â†’ è¯·æ±‚å…¬ä»”æ¨¡å‹ä¿¡æ¯ â†’ å…¬ä»”å·²å‘å¸ƒ â†’ åˆ¤æ–­å…¬ä»”IDåŒ…å«å¤§å†™"C"
- (void)home:(ThingSmartHome *)home device:(ThingSmartDeviceModel *)device dpsUpdate:(NSDictionary *)dps {
    if (![PublicObj isEmptyObject:dps]) {
        NSString *hardwareCode = dps[@"103"];
        if(![PublicObj isEmptyObject:hardwareCode] && ![hardwareCode isEqualToString:self.lastHardwareCode] && [dps allKeys].count == 1){
            // è¯·æ±‚å…¬ä»”æ¨¡å‹ä¿¡æ¯
            [[APIManager shared] GET:[APIPortConfiguration getDoolModelGetUrl] parameter:param success:^(id result, id data, NSString *msg) {
                FindDollModel *model = [FindDollModel mj_objectWithKeyValues:data];
                if([model.releaseStatus isEqualToString:@"released"]){
                    // åˆ¤æ–­å…¬ä»”IDæ˜¯å¦åŒ…å«å¤§å†™"C"
                    if ([model.Id containsString:@"C"]) {
                        // åŸ‹ç‚¹ä¸ŠæŠ¥ï¼šå‘ç°åˆ›æ„å…¬ä»”
                        [[AnalyticsManager sharedManager] reportDiscoverCreativeDollWithId:model.Id ?: @""
                                                                                      name:model.name ?: @""];
                    }
                    // æ˜¾ç¤ºå…¬ä»”å‘ç°å¼¹çª—
                    // ...
                }
            }];
        }
    }
}
```

#### 1.4 æ¢ç´¢é¡µé¢å…¬ä»”ç‚¹å‡»åŸ‹ç‚¹
- **æ–‡ä»¶ä½ç½®**: `AIToys/Home/View/HomeExploreToysView.m`
- **è§¦å‘æ—¶æœº**: ç”¨æˆ·åœ¨æ¢ç´¢é¡µé¢ç‚¹å‡»å…¬ä»”æ—¶
- **å®ç°ä»£ç **:
```objc
// åŸ‹ç‚¹ä¸ŠæŠ¥ï¼šæ¢ç´¢é¡µé¢ç‚¹å‡»å…¬ä»”
[[AnalyticsManager sharedManager] reportExploreClickDollWithId:weakSelf.model.Id ?: @"" 
                                                          name:weakSelf.model.name ?: @""];
```

### 2. è®¾å¤‡æ·»åŠ ç›¸å…³åŸ‹ç‚¹

#### 2.1 æ·»åŠ è®¾å¤‡ç‚¹å‡»åŸ‹ç‚¹ï¼ˆè‡ªåŠ¨é…ç½‘ï¼‰
- **æ–‡ä»¶ä½ç½®**: `AIToys/Home/DistributionNetwork/DeviceAddVC.m`
- **è§¦å‘æ—¶æœº**: ç”¨æˆ·ç‚¹å‡»æ‰«æåˆ°çš„è®¾å¤‡è¿›è¡Œè‡ªåŠ¨é…ç½‘æ—¶
- **å®ç°ä»£ç **:
```objc
// åŸ‹ç‚¹ä¸ŠæŠ¥ï¼šæ·»åŠ è®¾å¤‡ç‚¹å‡»ï¼ˆè‡ªåŠ¨é…ç½‘ï¼‰
NSString *productId = weakSelf.deviceInfo.productId ?: @"";
[[AnalyticsManager sharedManager] reportAddDeviceClickWithPid:productId];
```

#### 2.2 æ·»åŠ è®¾å¤‡ç‚¹å‡»åŸ‹ç‚¹ï¼ˆæ‰‹åŠ¨æ·»åŠ ï¼‰
- **æ–‡ä»¶ä½ç½®**: `AIToys/Home/DistributionNetwork/FindDeviceViewController.m`
- **è§¦å‘æ—¶æœº**: ç”¨æˆ·ç‚¹å‡»æ‰‹åŠ¨æ·»åŠ è®¾å¤‡æ—¶
- **å®ç°ä»£ç **:
```objc
// åŸ‹ç‚¹ä¸ŠæŠ¥ï¼šæ‰‹åŠ¨æ·»åŠ è®¾å¤‡ç‚¹å‡»
NSString *productId = @"";

// ä¼˜å…ˆä»æ‰«æåˆ°çš„è®¾å¤‡ä¸­è·å–productId
if (weakSelf.deviceList.count > 0) {
    ThingBLEAdvModel *firstDevice = weakSelf.deviceList.firstObject;
    productId = firstDevice.productId ?: @"";
} else if (weakSelf.deviceInfoList.count > 0) {
    NSDictionary *deviceInfo = weakSelf.deviceInfoList.firstObject;
    NSDictionary *result = deviceInfo[@"result"];
    productId = result[@"productId"] ?: @"";
}

// å¦‚æœä»ç„¶æ²¡æœ‰è·å–åˆ°productIdï¼Œä½¿ç”¨é»˜è®¤å€¼
if ([productId isEqualToString:@""]) {
    productId = DEVICE_PRODUCT_ID;
}

[[AnalyticsManager sharedManager] reportAddDeviceManualClickWithPid:productId];
```

#### 2.3 è®¾å¤‡æ·»åŠ æˆåŠŸåŸ‹ç‚¹
- **æ–‡ä»¶ä½ç½®**: `AIToys/Home/DistributionNetwork/DeviceAddVC.m`
- **è§¦å‘æ—¶æœº**: è®¾å¤‡é…ç½‘æˆåŠŸï¼Œè®¾å¤‡IDæ¿€æ´»æ—¶
- **å®ç°ä»£ç **:
```objc
// åŸ‹ç‚¹ä¸ŠæŠ¥ï¼šæ·»åŠ è®¾å¤‡æˆåŠŸ
[[AnalyticsManager sharedManager] reportAddDeviceSuccessWithDeviceId:deviceModel.devId ?: @"" 
                                                                 pid:self.deviceInfo.productId ?: @""];
```

#### 2.4 è®¾å¤‡æ·»åŠ å¤±è´¥åŸ‹ç‚¹
- **æ–‡ä»¶ä½ç½®**: `AIToys/Home/DistributionNetwork/DeviceAddVC.m`
- **è§¦å‘æ—¶æœº**: è®¾å¤‡æ·»åŠ å¤±è´¥æ—¶
- **å®ç°ä»£ç **:
```objc
// åŸ‹ç‚¹ä¸ŠæŠ¥ï¼šæ·»åŠ è®¾å¤‡å¤±è´¥
[[AnalyticsManager sharedManager] reportAddDeviceFailedWithErrorCode:error.code];
```

### 3. ç”¨æˆ·è´¦æˆ·ç›¸å…³åŸ‹ç‚¹

#### 3.1 ç™»å½•æˆåŠŸåŸ‹ç‚¹
- **æ–‡ä»¶ä½ç½®**: `AIToys/Login/AcountLoginViewController.m`
- **è§¦å‘æ—¶æœº**: ç”¨æˆ·ç™»å½•æˆåŠŸæ—¶
- **å®ç°ä»£ç **:
```objc
// åŸ‹ç‚¹ä¸ŠæŠ¥ï¼šç™»å½•æˆåŠŸ
NSDateFormatter *formatter = [[NSDateFormatter alloc] init];
formatter.dateFormat = @"yyyy-MM-dd HH:mm:ss";
NSString *loginTime = [formatter stringFromDate:[NSDate date]];
[[AnalyticsManager sharedManager] reportAccountLoginSuccessWithId:uid ?: @"" 
                                                        loginTime:loginTime 
                                                           region:Country_Code];
```

### 4. å®¶åº­æˆå‘˜ç®¡ç†ç›¸å…³åŸ‹ç‚¹

#### 4.1 æ·»åŠ å®¶åº­æˆå‘˜åŸ‹ç‚¹
- **æ–‡ä»¶ä½ç½®**: `AIToys/Home/FamailyManage/AddFamailyMemeberVC.m`
- **è§¦å‘æ—¶æœº**: æˆåŠŸæ·»åŠ å®¶åº­æˆå‘˜æ—¶
- **å®ç°ä»£ç **:
```objc
// åŸ‹ç‚¹ä¸ŠæŠ¥ï¼šå®¶åº­ç©ºé—´æ·»åŠ æˆå‘˜
NSString *permission = kAnalyticsPermission_Admin; // é»˜è®¤æ·»åŠ çš„æ˜¯ç®¡ç†å‘˜æƒé™
NSString *homeId = [NSString stringWithFormat:@"%lld", (long long)weakSelf.homeModel.homeId];

// å°è¯•ä»è¿”å›çš„å­—å…¸ä¸­è·å–æ–°æ·»åŠ æˆå‘˜çš„ID
NSString *familyMemberId = @"";
if (dict && [dict isKindOfClass:[NSDictionary class]]) {
    id memberIdValue = dict[@"memberId"] ?: dict[@"memberID"] ?: dict[@"id"] ?: dict[@"member_id"];
    if (memberIdValue) {
        familyMemberId = [NSString stringWithFormat:@"%@", memberIdValue];
    }
}

// è·å–å®¶åº­æ‹¥æœ‰è€…IDï¼ˆå½“å‰ç”¨æˆ·IDï¼‰
NSNumber *currentUserId = [[AnalyticsManager sharedManager] getCurrentUserId];
NSString *homeOwnerId = currentUserId ? [NSString stringWithFormat:@"%@", currentUserId] : @"";

[[AnalyticsManager sharedManager] reportFamilyAddMemberWithPermission:permission
                                                                homeId:homeId
                                                       familyMemberId:familyMemberId
                                                          homeOwnerId:homeOwnerId];
```

#### 4.2 ç§»é™¤å®¶åº­æˆå‘˜åŸ‹ç‚¹
- **æ–‡ä»¶ä½ç½®**: `AIToys/Home/FamailyManage/FamailyMemeberVC.m`
- **è§¦å‘æ—¶æœº**: æˆåŠŸç§»é™¤å®¶åº­æˆå‘˜æ—¶
- **å®ç°ä»£ç **:
```objc
// åŸ‹ç‚¹ä¸ŠæŠ¥ï¼šå®¶åº­ç©ºé—´ç§»é™¤æˆå‘˜
NSString *familyId = [NSString stringWithFormat:@"%lld", (long long)weakSelf.homeModel.homeId];
NSString *userId = [NSString stringWithFormat:@"%lld", (long long)weakSelf.memberModel.memberId];
[[AnalyticsManager sharedManager] reportFamilyRemoveMemberWithFamilyId:familyId userId:userId];
```

#### 4.3 ä¿®æ”¹æˆå‘˜æƒé™åŸ‹ç‚¹
- **æ–‡ä»¶ä½ç½®**: `AIToys/Home/FamailyManage/FamailyMemeberVC.m`
- **è§¦å‘æ—¶æœº**: ä¿®æ”¹å®¶åº­æˆå‘˜æƒé™æ—¶
- **å®ç°ä»£ç **:
```objc
// åŸ‹ç‚¹ä¸ŠæŠ¥ï¼šå®¶åº­ç©ºé—´ä¿®æ”¹æˆå‘˜æƒé™
NSString *permission = @"";
switch (requestModel.role) {
    case ThingHomeRoleType_Owner:
        permission = kAnalyticsPermission_Owner;
        break;
    case ThingHomeRoleType_Admin:
        permission = kAnalyticsPermission_Admin;
        break;
    case ThingHomeRoleType_Member:
        permission = kAnalyticsPermission_Normal;
        break;
    default:
        permission = kAnalyticsPermission_Normal;
        break;
}
[[AnalyticsManager sharedManager] reportFamilyModifyMemberPermissionWithPermission:permission];
```

## ğŸ”§ æŠ€æœ¯å®ç°

### è‡ªåŠ¨æ”¶é›†çš„ä¿¡æ¯
- ~~**ç”¨æˆ·ä¿¡æ¯**: å·²ç§»é™¤ç”¨æˆ·IDæ”¶é›†ä»¥ä¿æŠ¤éšç§~~
- âœ… **è®¾å¤‡ä¿¡æ¯**: è‡ªåŠ¨è·å–åº”ç”¨ç‰ˆæœ¬ã€ç³»ç»Ÿç‰ˆæœ¬ã€æ“ä½œç³»ç»Ÿç±»å‹
- âœ… **æ—¶é—´ä¿¡æ¯**: è‡ªåŠ¨è®°å½•äº‹ä»¶å‘ç”Ÿçš„å‡†ç¡®æ—¶é—´

### ç½‘ç»œä¸ŠæŠ¥
- âœ… **æ¥å£åœ°å€**: `/app-api/content/app-event-log/create`
- âœ… **è¯·æ±‚æ–¹å¼**: POST (JSONæ ¼å¼)
- âœ… **é”™è¯¯å¤„ç†**: è‡ªåŠ¨å¤„ç†ç½‘ç»œé”™è¯¯å¹¶è¾“å‡ºæ—¥å¿—

## ğŸ“‹ CSVæ–‡ä»¶è¦†ç›–æƒ…å†µ

| CSVä¸­çš„äº‹ä»¶ | å®ç°çŠ¶æ€ | æ–‡ä»¶ä½ç½® |
|------------|---------|----------|
| ç‚¹å‡»è¿è¥banner | âœ… å·²å®ç° | HomeViewController.m |
| æ·»åŠ è®¾å¤‡_ç‚¹å‡» | âœ… å·²å®ç° | DeviceAddVC.m |
| æ·»åŠ è®¾å¤‡_è“ç‰™é…å¯¹ | âœ… å·²å®ç° | DeviceAddVC.m |
| æ·»åŠ è®¾å¤‡_æ·»åŠ æˆåŠŸ | âœ… å·²å®ç° | DeviceAddVC.m |
| æ·»åŠ è®¾å¤‡_æ·»åŠ å¤±è´¥ | âœ… å·²å®ç° | DeviceAddVC.m |
| æˆ‘çš„è®¾å¤‡_ç‚¹å‡» | âœ… å·²å®ç° | HomeViewController.m |
| æˆ‘çš„å…¬ä»”_ç‚¹å‡» | âœ… å·²å®ç° | HomeViewController.m, HomeToysListVC.m |
| æ¢ç´¢_ç‚¹å‡»å…¬ä»” | âœ… å·²å®ç° | HomeExploreToysView.m |
| è´¦æˆ·_æ³¨å†ŒæˆåŠŸ | âœ… å·²å®ç° | SetPasswordVC.m |
| è´¦æˆ·_æ³¨å†Œå¤±è´¥ | âœ… å·²å®ç° | SetPasswordVC.m |
| è´¦æˆ·_ç™»å½•æˆåŠŸ | âœ… å·²å®ç° | AcountLoginViewController.m |
| å®¶åº­ç©ºé—´_æ·»åŠ æˆå‘˜ | âœ… å·²å®ç° | AddFamailyMemeberVC.m |
| å®¶åº­ç©ºé—´_ç§»é™¤æˆå‘˜ | âœ… å·²å®ç° | FamailyMemeberVC.m |
| å®¶åº­ç©ºé—´_ä¿®æ”¹æˆå‘˜æƒé™ | âœ… å·²å®ç° | FamailyMemeberVC.m |

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

1. **æµ‹è¯•éªŒè¯**: åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯æ‰€æœ‰åŸ‹ç‚¹æ˜¯å¦æ­£ç¡®ä¸ŠæŠ¥
2. **æ•°æ®ç›‘æ§**: è§‚å¯ŸåŸ‹ç‚¹æ•°æ®çš„å‡†ç¡®æ€§å’Œå®Œæ•´æ€§
3. **æ€§èƒ½è¯„ä¼°**: ç›‘æ§åŸ‹ç‚¹å¯¹åº”ç”¨æ€§èƒ½çš„å½±å“
4. **æ‰©å±•åŠŸèƒ½**: æ ¹æ®ä¸šåŠ¡éœ€æ±‚æ·»åŠ æ›´å¤šåŸ‹ç‚¹äº‹ä»¶

## ğŸ“ æ³¨æ„äº‹é¡¹

- æ‰€æœ‰åŸ‹ç‚¹éƒ½å·²é›†æˆåˆ°ç°æœ‰ä¸šåŠ¡æµç¨‹ä¸­ï¼Œä¸ä¼šå½±å“åŸæœ‰åŠŸèƒ½
- åŸ‹ç‚¹ä¸ŠæŠ¥æ˜¯å¼‚æ­¥è¿›è¡Œçš„ï¼Œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹
- ç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†ç½‘ç»œé”™è¯¯ï¼Œç¡®ä¿åº”ç”¨ç¨³å®šæ€§
- æ‰€æœ‰åŸ‹ç‚¹å¸¸é‡éƒ½å·²å®šä¹‰åœ¨ `AnalyticsConstants.h` ä¸­ï¼Œä¾¿äºç»´æŠ¤
